
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>More Operators &#8212; Learn TLA+</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Action Properties" href="action-properties.html" />
    <link rel="prev" title="Temporal Properties" href="temporal-logic.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../index.html" title="Go to homepage">Learn TLA+</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/conceptual-overview.html">Conceptual Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TLA+</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="operators.html">Operators and Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluscal.html">Writing Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="invariants.html">Writing an Invariant</a></li>
<li class="toctree-l2"><a class="reference internal" href="constants.html">Parameterizing Specs</a></li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Structured Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="nondeterminism.html">Nondeterminism</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="temporal-logic.html">Temporal Properties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">More Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="action-properties.html">Action Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="tla.html">TLA+</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="next-steps.html">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Topics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html#pluscal-specs">PlusCal Specs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/standard-library.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/other-resources.html">Other Resources</a></li>
</ul>

<ul>
  <li class="toctree-l1"><a href= "../genindex.html">Index</a></li>
</ul>
        </div>
      </div>



    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="more-operators">
<span id="chapter-advanced-operators"></span><h1>More Operators<a class="headerlink" href="#more-operators" title="Permalink to this headline">¶</a></h1>
<p>This isn’t much more complicated than the last sections, but this is the best place to put it. So we can now model concurrent algorithms and write complex liveness properties. You know what we can’t do?</p>
<p>Sum up a sequence.</p>
<p>I mean sure, we can write a Pluscal algorithm to do that:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="c c-PreProc">----</span> <span class="c c-PreProc">MODULE</span> <span class="c c-PreProc">sum</span> <span class="c c-PreProc">----</span>
<span class="kn">EXTENDS</span> <span class="n">Integers</span><span class="p">,</span> <span class="n">Sequences</span><span class="p">,</span> <span class="n">TLC</span><span class="p">,</span> <span class="n">FiniteSets</span>
<span class="kn">CONSTANT</span> <span class="n">S</span>
<span class="kn">ASSUME</span> <span class="n">S</span> <span class="nb">\subseteq</span> <span class="n">Int</span>

<span class="n">SumSeq</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="c">\* ???</span>

<span class="nf">(*--algorithm dup</span>
<span class="n">variable</span> 
  <span class="n">seq</span> <span class="s">\in</span> <span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="m">5</span> <span class="o">-&gt;</span> <span class="n">S</span><span class="p">];</span>
  <span class="n">sum</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>

<span class="nf">define</span>
  <span class="n">TypeInvariant</span> <span class="o">==</span>
    <span class="o">/\</span> <span class="n">sum</span> <span class="s">\in</span> <span class="n">Int</span>
    <span class="o">/\</span> <span class="n">i</span> <span class="s">\in</span> <span class="m">1</span><span class="o">..</span><span class="n">Len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">+</span><span class="m">1</span>

  <span class="n">IsCorrect</span> <span class="o">==</span> <span class="n">pc</span> <span class="o">=</span> <span class="s">&quot;Done&quot;</span> <span class="o">=&gt;</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">SumSeq</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<span class="nf">end define</span><span class="p">;</span> 

<span class="nf">macro</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="nf">begin</span>
  <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">val</span>
<span class="nf">end macro</span><span class="p">;</span>

<span class="nf">begin</span>
<span class="nt">  Iterate:</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">Len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">add</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">while</span><span class="p">;</span>
<span class="nf">end algorithm; *)</span>
<span class="c c-PreProc">====</span>
</pre></div>
</div>
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/fc3f039c97ac4805525a37eabda51870/sum.tla"><code class="xref download docutils literal notranslate"><span class="pre">spec</span></code></a></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
</div>
<p>But how the heck do you write <code class="docutils literal notranslate"><span class="pre">SumSeq</span></code>?!</p>
<p>We <em>can</em> do this with what we’ve learned so far, but it’s really complicated and annoying and I don’t expect you to figure it out on your own. Maybe I’ll push it to a topic or something. But motivated by the annoyingness of summing sequences, in 2008 TLA+ was updated to include recursive operators.</p>
<section id="recursive-operators">
<span id="recursive"></span><span id="index-0"></span><h2>Recursive Operators<a class="headerlink" href="#recursive-operators" title="Permalink to this headline">¶</a></h2>
<p>Recursive operators have to be predefined, like this:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">RECURSIVE</span> <span class="n">SumSeq</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">(_)</span></code> is the number of arguments you want in advance. So for a 2-parameter operator, you’d write <code class="docutils literal notranslate"><span class="pre">Op(_,</span> <span class="pre">_)</span></code>. Once you’ve done this, you can define the operator as normal, except it’s able to reference itself:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">SumSeq</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="k k-Conditional">IF</span> <span class="n">s</span> <span class="o">=</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="k k-Conditional">THEN</span> <span class="m">0</span> <span class="k k-Conditional">ELSE</span>
  <span class="n">Head</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">SumSeq</span><span class="p">(</span><span class="n">Tail</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>Easy. In fac we can put the <code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code> part inside a <a class="reference internal" href="operators.html#let"><span class="std std-ref">LET</span></a>, to make a helper op:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">SumSeq</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="k k-Conditional">LET</span>
  <span class="n">RECURSIVE</span> <span class="n">Helper</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
  <span class="n">Helper</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span> <span class="o">==</span> <span class="k k-Conditional">IF</span> <span class="n">s_</span> <span class="o">=</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="k k-Conditional">THEN</span> <span class="m">0</span> <span class="k k-Conditional">ELSE</span>
  <span class="n">Head</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Helper</span><span class="p">(</span><span class="n">Tail</span><span class="p">(</span><span class="n">s_</span><span class="p">))</span>
<span class="n">IN</span> <span class="n">Helper</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>There’s no syntactic check that the recursion ends. If you have unbound recursion then TLC will throw a stack overflow error.</p>
<p class="rubric">Recursion on a set and commutativity</p>
<p>If we want to do the same thing with summing a set, we need a way to pick a single element for recursion. Naturally, the easiest way to do that is with <a class="reference internal" href="operators.html#choose"><span class="std std-ref">CHOOSE</span></a>.</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">RECURSIVE</span> <span class="n">SetSum</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>

<span class="n">SetSum</span><span class="p">(</span><span class="n">set</span><span class="p">)</span> <span class="o">==</span> <span class="k k-Conditional">IF</span> <span class="n">set</span> <span class="o">=</span> <span class="n">{}</span> <span class="k k-Conditional">THEN</span> <span class="m">0</span> <span class="k k-Conditional">ELSE</span>
  <span class="k k-Conditional">LET</span> <span class="n">x</span> <span class="o">==</span> <span class="s">CHOOSE</span> <span class="n">x</span> <span class="s">\in</span> <span class="n">set</span><span class="p">:</span> <span class="bp">TRUE</span>
    <span class="n">IN</span> <span class="n">x</span> <span class="o">+</span> <span class="n">SetSum</span><span class="p">(</span><span class="n">set</span> <span class="o">\</span> <span class="n">{x}</span><span class="p">)</span>
</pre></div>
</div>
<p>Seeing this should worry you. There isn’t a unique choice of <code class="docutils literal notranslate"><span class="pre">x</span></code>: <em>every</em> element of the set satisfies <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>! This means that <a class="reference internal" href="operators.html#choose-deterministic"><span class="std std-ref">TLC will choose the lowest value</span></a>.</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">RECURSIVE</span> <span class="n">SetToSeq</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>

<span class="n">SetToSeq</span><span class="p">(</span><span class="n">set</span><span class="p">)</span> <span class="o">==</span> <span class="k k-Conditional">IF</span> <span class="n">set</span> <span class="o">=</span> <span class="n">{}</span> <span class="k k-Conditional">THEN</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="k k-Conditional">ELSE</span>
  <span class="k k-Conditional">LET</span> <span class="n">x</span> <span class="o">==</span> <span class="s">CHOOSE</span> <span class="n">x</span> <span class="s">\in</span> <span class="n">set</span><span class="p">:</span> <span class="bp">TRUE</span>
    <span class="n">IN</span> <span class="o">&lt;&lt;</span><span class="n">x</span><span class="o">&gt;&gt;</span> <span class="nb">\o</span> <span class="n">SetToSeq</span><span class="p">(</span><span class="n">set</span> <span class="o">\</span> <span class="n">{x}</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; SetToSeq({6, 8, 1, 2, -1, 5})

&lt;&lt;-1, 1, 2, 5, 6, 8&gt;&gt;
</pre></div>
</div>
<p>Sometimes this doesn’t matter like in <code class="docutils literal notranslate"><span class="pre">SetSum</span></code>. But if it might, you should specify a unique selection predicate for your choose, like explicitly choosing the minimum value.</p>
</section>
<section id="higher-order-operators">
<span id="index-1"></span><h2>Higher-order Operators<a class="headerlink" href="#higher-order-operators" title="Permalink to this headline">¶</a></h2>
<p>Next up: operators that take other operators as functions. That way we can have <code class="docutils literal notranslate"><span class="pre">SeqMap</span></code>. Here’s how we can define <code class="docutils literal notranslate"><span class="pre">SeqMap</span></code> with a function:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">SeqMap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">i</span> <span class="s">\in</span> <span class="n">DOMAIN</span> <span class="n">seq</span> <span class="o">|-&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span>
</pre></div>
</div>
<p>But if we want to use an operator, we’d write it this way instead:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">SeqMap</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="n">_</span><span class="p">),</span> <span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">i</span> <span class="s">\in</span> <span class="n">DOMAIN</span> <span class="n">seq</span> <span class="o">|-&gt;</span> <span class="n">Op</span><span class="p">([</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]])]</span>
</pre></div>
</div>
<p>Not too bad. You can define anonymous operators with <code class="docutils literal notranslate"><span class="pre">LAMBDA</span></code>:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">SeqMap</span><span class="p">(</span><span class="n">LAMBDA</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="c">\* &lt;&lt;2, 3, 4&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You can’t combine recursive and higher-order operators.</p>
</div>
</section>
<section id="binary-operators">
<span id="index-2"></span><h2>Binary operators<a class="headerlink" href="#binary-operators" title="Permalink to this headline">¶</a></h2>
<p>If you <a class="reference internal" href="../topics/toolbox.html#toolbox-misc"><span class="std std-ref">peek</span></a> at the definition of the <code class="docutils literal notranslate"><span class="pre">Sequences</span></code> module, you’ll see how it defines <code class="docutils literal notranslate"><span class="pre">\o</span></code>:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="nb">\o</span> <span class="n">t</span> <span class="o">==</span> <span class="p">[</span><span class="n">i</span> <span class="s">\in</span> <span class="m">1</span><span class="o">..</span><span class="p">(</span><span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">Len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">|-&gt;</span> <span class="k k-Conditional">IF</span> <span class="n">i</span> <span class="nb">\leq</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k k-Conditional">THEN</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                                         <span class="k k-Conditional">ELSE</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)]]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">\o</span></code> is a binary operator. There’s a fixed set of binary operators, like <code class="docutils literal notranslate"><span class="pre">\o</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, and <code class="docutils literal notranslate"><span class="pre">\prec</span></code>, that you can define. On the whole I don’t like doing this because it makes specs confusing, but there’s a couple I use often:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">set</span> <span class="o">++</span> <span class="n">x</span> <span class="o">==</span> <span class="n">set</span> <span class="nb">\union</span> <span class="n">{x}</span>
<span class="n">set</span> <span class="o">--</span> <span class="n">x</span> <span class="o">==</span> <span class="n">set</span> <span class="o">\</span> <span class="n">{x}</span>
</pre></div>
</div>
</section>
<section id="function-operators">
<h2>Function Operators<a class="headerlink" href="#function-operators" title="Permalink to this headline">¶</a></h2>
<p>This is a bit of syntactic sugar for writing top-level functions:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">Double</span> <span class="o">==</span> <span class="p">[</span><span class="n">x</span> <span class="s">\in</span> <span class="m">1</span><span class="o">..</span><span class="m">10</span> <span class="o">|-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="m">2</span><span class="p">]</span>

<span class="c">\* can also be written as</span>

<span class="n">Double</span><span class="p">[</span><span class="n">x</span> <span class="s">\in</span> <span class="m">1</span><span class="o">..</span><span class="m">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span> <span class="o">*</span> <span class="m">2</span>
</pre></div>
</div>
<p>This is primarily for writing recursive functions:</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">Factorial</span><span class="p">[</span><span class="n">x</span> <span class="s">\in</span> <span class="m">0</span><span class="o">..</span><span class="m">10</span><span class="p">]</span> <span class="o">==</span> <span class="k k-Conditional">IF</span> <span class="n">x</span> <span class="o">=</span> <span class="m">0</span> <span class="k k-Conditional">THEN</span> <span class="m">1</span> <span class="k k-Conditional">ELSE</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Factorial</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="m">1</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="case">
<span id="index-3"></span><span id="id1"></span><h2>CASE<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h2>
<p>I had nowhere else to put this so I’m just dumping it here for completion’s sake.</p>
<div class="highlight-tla notranslate"><div class="highlight"><pre><span></span><span class="n">Fizzbuzz</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span>
  <span class="k k-Conditional">CASE</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="m">3</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">/\</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="m">5</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s">&quot;Fizzbuzz&quot;</span>
    <span class="ni">[]</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="m">3</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>                <span class="o">-&gt;</span> <span class="s">&quot;Fizz&quot;</span>
    <span class="ni">[]</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="m">5</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>                <span class="o">-&gt;</span> <span class="s">&quot;Buzz&quot;</span>
    <span class="ni">[]</span> <span class="k k-Conditional">OTHER</span>                      <span class="o">-&gt;</span> <span class="n">x</span>
</pre></div>
</div>
<p>If nothing matches (and you didn’t have an <code class="docutils literal notranslate"><span class="pre">OTHER</span></code>), then TLC raises an error. If more than one thing matches, it’s implementation-defined what actually is executed, and TLC will pick the first choice that matches.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">More Operators</a><ul>
<li><a class="reference internal" href="#recursive-operators">Recursive Operators</a></li>
<li><a class="reference internal" href="#higher-order-operators">Higher-order Operators</a></li>
<li><a class="reference internal" href="#binary-operators">Binary operators</a></li>
<li><a class="reference internal" href="#function-operators">Function Operators</a></li>
<li><a class="reference internal" href="#case">CASE</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="temporal-logic.html">
                    <span class="icon">&lt;</span><span>Temporal Properties</span></a>
                
            </div>

            <div class="right">
                
                    <a href="action-properties.html"><span>Action Properties</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Hillel Wayne.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>